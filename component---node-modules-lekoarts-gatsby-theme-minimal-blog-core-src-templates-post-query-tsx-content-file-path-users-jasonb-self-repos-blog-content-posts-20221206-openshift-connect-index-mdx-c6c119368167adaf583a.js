"use strict";(self.webpackChunkblog=self.webpackChunkblog||[]).push([[32],{4765:function(e,t,n){n.d(t,{F:function(){return g},Z:function(){return f}});var o=n(6459),l=n(7294),a=n(977),r=n(9935),c=n(1131),i=n(6799),s=n(8871),p=function(e){e.post;return null},u=n(9706),h=n(3494),m=["16px","8px","4px"].map((function(e){return"rgba(0, 0, 0, 0.1) 0px "+e+" "+e+" 0px"})),d=function(e){var t=e.data.post,n=e.children;return(0,a.tZ)(c.Z,null,(0,a.tZ)(r.X6,{as:"h1",variant:"styles.h1"},t.title),(0,a.tZ)("p",{sx:{color:"secondary",mt:3,a:{color:"secondary"},fontSize:[1,1,2]}},(0,a.tZ)("time",null,t.date),t.tags&&(0,a.tZ)(l.Fragment,null," — ",(0,a.tZ)(i.Z,{tags:t.tags})),t.timeToRead&&" — ",t.timeToRead&&(0,a.tZ)("span",null,t.timeToRead," min read")),(0,a.tZ)("section",{sx:{my:5,".gatsby-resp-image-wrapper":{my:[4,4,5],borderRadius:"4px",boxShadow:m.join(", "),".gatsby-resp-image-image":{borderRadius:"4px"}},variant:"layout.content"}},n),(0,a.tZ)(p,{post:t}))},g=function(e){var t,n,o,l=e.data.post,r=(0,h.Z)(),c=r.basePath,i=r.blogPath;return(0,a.tZ)(s.Z,{title:l.title,description:l.description?l.description:l.excerpt,image:l.banner?null===(t=l.banner)||void 0===t||null===(n=t.childImageSharp)||void 0===n||null===(o=n.resize)||void 0===o?void 0:o.src:void 0,pathname:(0,u.Z)("/"+c+"/"+i+"/"+l.slug),canonicalUrl:l.canonicalUrl})};function f(e){var t=Object.assign({},((0,o.Z)(e),e));return l.createElement(d,t)}},6799:function(e,t,n){var o=n(977),l=n(7294),a=n(1082),r=n(3494),c=n(9706);t.Z=function(e){var t=e.tags,n=(0,r.Z)(),i=n.tagsPath,s=n.basePath;return(0,o.tZ)(l.Fragment,null,t.map((function(e,t){return(0,o.tZ)(l.Fragment,{key:e.slug},!!t&&", ",(0,o.tZ)(a.Link,{sx:function(e){var t;return Object.assign({},null===(t=e.styles)||void 0===t?void 0:t.a)},to:(0,c.Z)("/"+s+"/"+i+"/"+e.slug)},e.name))})))}},8871:function(e,t,n){var o=n(7294),l=n(1082),a=n(4232);t.Z=function(e){var t=e.title,n=void 0===t?"":t,r=e.description,c=void 0===r?"":r,i=e.pathname,s=void 0===i?"":i,p=e.image,u=void 0===p?"":p,h=e.children,m=void 0===h?null:h,d=e.canonicalUrl,g=void 0===d?"":d,f=(0,a.Z)(),E=f.siteTitle,v=f.siteTitleAlt,y=f.siteUrl,b=f.siteDescription,w=f.siteImage,T=f.author,P={title:n?n+" | "+E:v,description:c||b,url:""+y+(s||""),image:""+y+(u||w)};return o.createElement(o.Fragment,null,o.createElement("title",null,P.title),o.createElement("meta",{name:"description",content:P.description}),o.createElement("meta",{name:"image",content:P.image}),o.createElement("meta",{property:"og:title",content:P.title}),o.createElement("meta",{property:"og:url",content:P.url}),o.createElement("meta",{property:"og:description",content:P.description}),o.createElement("meta",{property:"og:image",content:P.image}),o.createElement("meta",{property:"og:type",content:"website"}),o.createElement("meta",{property:"og:image:alt",content:P.description}),o.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),o.createElement("meta",{name:"twitter:title",content:P.title}),o.createElement("meta",{name:"twitter:url",content:P.url}),o.createElement("meta",{name:"twitter:description",content:P.description}),o.createElement("meta",{name:"twitter:image",content:P.image}),o.createElement("meta",{name:"twitter:image:alt",content:P.description}),o.createElement("meta",{name:"twitter:creator",content:T}),o.createElement("meta",{name:"gatsby-theme",content:"@lekoarts/gatsby-theme-minimal-blog"}),o.createElement("link",{rel:"icon",type:"image/png",sizes:"32x32",href:(0,l.withPrefix)("/favicon-32x32.png")}),o.createElement("link",{rel:"icon",type:"image/png",sizes:"16x16",href:(0,l.withPrefix)("/favicon-16x16.png")}),o.createElement("link",{rel:"apple-touch-icon",sizes:"180x180",href:(0,l.withPrefix)("/apple-touch-icon.png")}),g?o.createElement("link",{rel:"canonical",href:g}):null,m)}},2859:function(e,t,n){n.r(t),n.d(t,{Head:function(){return c.F},default:function(){return i}});var o=n(7294),l=n(9626);function a(e){var t=Object.assign({p:"p",a:"a",blockquote:"blockquote",ul:"ul",li:"li",h2:"h2",code:"code",pre:"pre",h3:"h3",em:"em"},(0,l.ah)(),e.components);return o.createElement(o.Fragment,null,o.createElement(t.p,null,"Once your app is ready, you excitedly deploy it to your favorite Kubernetes cluster, such as ",o.createElement(t.a,{href:"https://www.redhat.com/en/technologies/cloud-computing/openshift"},"Red Hat OpenShift"),". Inputting the URL into the browser, you hit enter and are greeted with..."),"\n",o.createElement(t.blockquote,null,"\n",o.createElement(t.p,null,"Application is not available"),"\n"),"\n",o.createElement(t.blockquote,null,"\n",o.createElement(t.p,null,"The application is currently not serving requests at this endpoint. It may not have been started or is still starting."),"\n"),"\n",o.createElement(t.p,null,"Well, that's a disappointment!"),"\n",o.createElement(t.p,null,"Fortunately, there are some steps that we can take to determine why your app isn't available to the world."),"\n",o.createElement(t.p,null,"This post makes a few assumptions about your app's deployment. In particular:"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"You deployed to a Red Hat OpenShift cluster (although this is mostly applicable to any Kubernetes cluster)"),"\n",o.createElement(t.li,null,"You created a ",o.createElement(t.a,{href:"https://kubernetes.io/docs/concepts/services-networking/service/"},"service resource")),"\n",o.createElement(t.li,null,"You created a ",o.createElement(t.a,{href:"https://docs.openshift.com/container-platform/4.11/networking/routes/route-configuration.html"},"route resource"),", which is specific to OpenShift and provides ingress for HTTP traffic"),"\n",o.createElement(t.li,null,"You are not using any ",o.createElement(t.a,{href:"https://kubernetes.io/docs/concepts/services-networking/network-policies/"},"network policies")," within your project"),"\n"),"\n",o.createElement(t.h2,null,"Our app deployment"),"\n",o.createElement(t.p,null,"By way of example, let's troubleshoot the ",o.createElement(t.a,{href:"https://github.com/openshift/origin/blob/master/examples/hello-openshift/README.md"},"OpenShift Hello app"),", deployed with the following manifest. The key aspects of this manifest are as follows:"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"A deployment that creates two pods that we can load balance traffic between"),"\n",o.createElement(t.li,null,"A service that manages our service endpoints, the two pods the deployment creates"),"\n",o.createElement(t.li,null,"A route that load balances incoming HTTP requests to our service endpoints"),"\n"),"\n",o.createElement(t.p,null,"It is essential that the TCP ports are specified correctly. The app uses ",o.createElement(t.code,null,"8080")," for HTTP traffic."),"\n",o.createElement(t.pre,null,o.createElement(t.code,{className:"language-yaml",title:"App deployment configuration",highlight:"21-23,35-37,47-49"},"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: openshift-hello\n  labels:\n    app: ocp\nspec:\n  replicas: 2\n  selector:\n    matchLabels:\n      app: ocp\n  template:\n    metadata:\n      labels:\n        app: ocp\n    spec:\n      containers:\n      - name: openshift-hello\n        image: openshift/hello-openshift:latest\n        imagePullPolicy: Always\n        ports:\n        - containerPort: 8080\n          protocol: TCP\n---\napiVersion: v1\nkind: Service\nmetadata:\n  name: openshift-hello-svc\n  labels:\n    app: ocp\nspec:\n  selector:\n    app: ocp\n  ports:\n  - port: 8080\n    protocol: TCP\n    targetPort: 8080\n  type: ClusterIP\n---\napiVersion: route.openshift.io/v1\nkind: Route\nmetadata:\n  name: hello-openshift\n  labels:\n    app: ocp\nspec:\n  host: openshift-hello.apps-crc.testing\n  port:\n    targetPort: 8080\n  tls:\n    termination: edge\n  to:\n    kind: Service\n    name: openshift-hello-svc\n    weight: 100\n  wildcardPolicy: None\n")),"\n",o.createElement(t.p,null,"And once executed, we see the following resources in our project:"),"\n",o.createElement(t.pre,null,o.createElement(t.code,{className:"language-none",title:"Output"},"$ oc get all -o wide\nNAME                                   READY   STATUS    RESTARTS   AGE   IP             NODE                 NOMINATED NODE   READINESS GATES\npod/openshift-hello-589f9c7749-rhb2p   1/1     Running   0          11h   10.217.0.232   crc-lgph7-master-0   <none>           <none>\npod/openshift-hello-589f9c7749-wbn9l   1/1     Running   0          11h   10.217.0.236   crc-lgph7-master-0   <none>           <none>\n\nNAME                          TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)    AGE   SELECTOR\nservice/openshift-hello-svc   ClusterIP   10.217.5.72   <none>        8080/TCP   11h   app=ocp\n\nNAME                              READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS        IMAGES                             SELECTOR\ndeployment.apps/openshift-hello   2/2     2            2           11h   openshift-hello   openshift/hello-openshift:latest   app=ocp\n\nNAME                                         DESIRED   CURRENT   READY   AGE   CONTAINERS        IMAGES                             SELECTOR\nreplicaset.apps/openshift-hello-589f9c7749   2         2         2       11h   openshift-hello   openshift/hello-openshift:latest   app=ocp,pod-template-hash=589f9c7749\n\nNAME                                       HOST/PORT                          PATH   SERVICES              PORT   TERMINATION   WILDCARD\nroute.route.openshift.io/hello-openshift   openshift-hello.apps-crc.testing          openshift-hello-svc   8080   edge          None\n")),"\n",o.createElement(t.h2,null,"Our troubleshooting steps"),"\n",o.createElement(t.p,null,"Given the deployment described in the previous section, now we can dive into troubleshooting. We want to check for connectivity issues between each resource. In particular, we're going to look whether the app responds to an HTTP request."),"\n",o.createElement(t.p,null,"We're going to answer the following questions:"),"\n",o.createElement(t.ul,null,"\n",o.createElement(t.li,null,"Did the app start successfully?"),"\n",o.createElement(t.li,null,"Can I connect to an app pod through a port forward?"),"\n",o.createElement(t.li,null,"Can I connect to the service?"),"\n",o.createElement(t.li,null,"Can I connect to the route?"),"\n"),"\n",o.createElement(t.p,null,"In all cases, ",o.createElement(t.code,null,"oc")," commands are executed within the ",o.createElement(t.code,null,"hello-openshift")," namespace."),"\n",o.createElement(t.h3,null,"Did the app start successfully?"),"\n",o.createElement(t.p,null,"For this, let's look at the logs for our app pods:"),"\n",o.createElement(t.pre,null,o.createElement(t.code,{className:"language-none",title:"Output"},"$ oc get pods -l app=ocp \\\n  -o jsonpath='{range .items[*]}pods/{.metadata.name}{\"\\n\"}{end}' | \\\n  xargs -L1 -I% bash -c 'echo % && oc logs %'\npods/openshift-hello-589f9c7749-rhb2p\nserving on 8888\nserving on 8080\nServicing request.\nServicing request.\nServicing request.\nServicing request.\nServicing request.\npods/openshift-hello-589f9c7749-wbn9l\nserving on 8888\nserving on 8080\nServicing request.\n")),"\n",o.createElement(t.p,null,"If the app log includes any errors, these are worth investigating further."),"\n",o.createElement(t.h3,null,"Can I connect to an app pod through a port forward?"),"\n",o.createElement(t.p,null,"For this, we can setup a port forward to an app pod and attempt to connect directly to the application, bypassing our ingress configuration."),"\n",o.createElement(t.pre,null,o.createElement(t.code,null,"$ oc port-forward pods/openshift-hello-589f9c7749-rhb2p 8080\nForwarding from 127.0.0.1:8080 -> 8080\nForwarding from [::1]:8080 -> 8080\n")),"\n",o.createElement(t.p,null,"With the forward successfully running, in a different terminal window, use the ",o.createElement(t.code,null,"curl")," command to test connectivity. (In this example, we're using an ",o.createElement(t.code,null,"http://")," URL because our app does not use TLS. Instead, we rely on the OpenShift ingress controller to manage TLS encryption at the ",o.createElement(t.em,null,"edge"),". This configuration is referred to as edge terminated.)"),"\n",o.createElement(t.pre,null,o.createElement(t.code,{className:"language-none",title:"Output"},"$ curl -v http://localhost:8080/\n*   Trying 127.0.0.1:8080...\n* Connected to localhost (127.0.0.1) port 8080 (#0)\n> GET / HTTP/1.1\n> Host: localhost:8080\n> User-Agent: curl/7.79.1\n> Accept: */*\n>\n* Mark bundle as not supporting multiuse\n< HTTP/1.1 200 OK\n< Date: Wed, 07 Dec 2022 23:17:43 GMT\n< Content-Length: 17\n< Content-Type: text/plain; charset=utf-8\n<\nHello OpenShift!\n* Connection #0 to host localhost left intact\n")),"\n",o.createElement(t.p,null,"And our app is reachable through the port forward."),"\n",o.createElement(t.h3,null,"Can I connect to the service?"),"\n",o.createElement(t.p,null,"Because our original manifest created a service for this, each app pod with the label ",o.createElement(t.code,null,"app=ocp")," is included as an endpoint for the ",o.createElement(t.code,null,"openshift-hello-svc")," service."),"\n",o.createElement(t.p,null,"By describing the service, we learn its endpoints: ",o.createElement(t.code,null,"10.217.0.232:8080")," and ",o.createElement(t.code,null,"10.217.0.236:8080"),". And these endpoints match the IP addresses for our app pods."),"\n",o.createElement(t.pre,null,o.createElement(t.code,{className:"language-none",title:"Output",highlight:"14"},"$ oc describe services/openshift-hello-svc\nName:              openshift-hello-svc\nNamespace:         hello-openshift\nLabels:            app=ocp\nAnnotations:       <none>\nSelector:          app=ocp\nType:              ClusterIP\nIP Family Policy:  SingleStack\nIP Families:       IPv4\nIP:                10.217.5.72\nIPs:               10.217.5.72\nPort:              <unset>  8080/TCP\nTargetPort:        8080/TCP\nEndpoints:         10.217.0.232:8080,10.217.0.236:8080\nSession Affinity:  None\nEvents:            <none>\n")),"\n",o.createElement(t.p,null,"Or we can look at the endpoint resources in the project. The IP addresses and ports match our ",o.createElement(t.code,null,"openshift-hello-svc")," service:"),"\n",o.createElement(t.pre,null,o.createElement(t.code,{className:"language-none",title:"Output"},"$ oc get endpoints\nNAME                  ENDPOINTS                             AGE\nopenshift-hello-svc   10.217.0.232:8080,10.217.0.236:8080   12h\n")),"\n",o.createElement(t.p,null,"For this connection test, let's use a ",o.createElement(t.a,{href:"https://github.com/nicolaka/netshoot"},"Netshoot")," container."),"\n",o.createElement(t.pre,null,o.createElement(t.code,{className:"language-none",title:"Output"},"kubectl run tmp-shell --rm -i --tty --image nicolaka/netshoot\n\n                    dP            dP                           dP   \n                    88            88                           88   \n88d888b. .d8888b. d8888P .d8888b. 88d888b. .d8888b. .d8888b. d8888P \n88'  `88 88ooood8   88   Y8ooooo. 88'  `88 88'  `88 88'  `88   88   \n88    88 88.  ...   88         88 88    88 88.  .88 88.  .88   88   \ndP    dP `88888P'   dP   `88888P' dP    dP `88888P' `88888P'   dP   \n                                                                    \nWelcome to Netshoot! (github.com/nicolaka/netshoot)\n")),"\n",o.createElement(t.p,null,"From the Netshoot container, let's confirm that we can access the cluster IP of the service, which internally routes the traffic to one of our app pods."),"\n",o.createElement(t.pre,null,o.createElement(t.code,{className:"language-none",title:"Output"},"$ curl -v http://10.217.5.72:8080/ \n*   Trying 10.217.5.72:8080...\n* Connected to 10.217.5.72 (10.217.5.72) port 8080 (#0)\n> GET / HTTP/1.1\n> Host: 10.217.5.72:8080\n> User-Agent: curl/7.86.0\n> Accept: */*\n> \n* Mark bundle as not supporting multiuse\n< HTTP/1.1 200 OK\n< Date: Fri, 09 Dec 2022 03:39:28 GMT\n< Content-Length: 17\n< Content-Type: text/plain; charset=utf-8\n< \nHello OpenShift!\n* Connection #0 to host 10.217.5.72 left intact\n#\n")),"\n",o.createElement(t.p,null,"Exit the shell to terminate the Netshoot pod."),"\n",o.createElement(t.h3,null,"Can I connect to the route?"),"\n",o.createElement(t.p,null,"Finally, let's check whether we can connect to the exposed public route of our app. We can describe the route and confirm what the hostname for our app is: ",o.createElement(t.code,null,"openshift-hello.apps-crc.testing"),"."),"\n",o.createElement(t.pre,null,o.createElement(t.code,{className:"language-none",title:"Output",highlight:"7-8"},"$ oc describe routes/hello-openshift\nName:\t\t\thello-openshift\nNamespace:\t\thello-openshift\nCreated:\t\t20 hours ago\nLabels:\t\t\tapp=ocp\n...\nRequested Host:\t\topenshift-hello.apps-crc.testing\n\t\t\t   exposed on router default (host router-default.apps-crc.testing) 20 hours ago\nPath:\t\t\t<none>\nTLS Termination:\tedge\nInsecure Policy:\t<none>\nEndpoint Port:\t\t8080\n\nService:\topenshift-hello-svc\nWeight:\t\t100 (100%)\nEndpoints:\t10.217.0.232:8080, 10.217.0.236:8080\n")),"\n",o.createElement(t.p,null,"In a browser, we can visit ",o.createElement(t.a,{href:"https://openshift-hello.apps-crc.testing/"},"https://openshift-hello.apps-crc.testing/")," to see if the app loads. Behind the scenes, the ingress controller is handling the TLS termination and load balancing across app endpoints."),"\n",o.createElement(t.p,null,"If we cannot connect successfully, on OpenShift it's ",o.createElement(t.a,{href:"https://stackoverflow.com/a/66563562"},"possible to enable logging")," on the ingress controller to investigate further."),"\n",o.createElement(t.p,null,"As a cluster administrator, edit the ingress controller configuration:"),"\n",o.createElement(t.pre,null,o.createElement(t.code,{className:"language-none",title:"Output"},"$ oc -n openshift-ingress-operator edit ingresscontrollers/default\n")),"\n",o.createElement(t.p,null,"Add the ",o.createElement(t.code,null,"spec.logging.access.*")," fields as described in the following YAML:"),"\n",o.createElement(t.pre,null,o.createElement(t.code,{className:"language-yaml",title:"Ingress controller logging configuration"},'apiVersion: operator.openshift.io/v1\nkind: IngressController\nmetadata:\n  name: default\n  namespace: openshift-ingress-operator\nspec:  \n  logging:\n    access:\n      destination:\n        type: Container\n      httpLogFormat: log_source="haproxy-default" log_type="http" c_ip="%ci" c_port="%cp" req_date="%tr" fe_name_transport="%ft" be_name="%b" server_name="%s" res_time="%TR" tot_wait_q="%Tw" Tc="%Tc" Tr="%Tr" Ta="%Ta" status_code="%ST" bytes_read="%B" bytes_uploaded="%U" captrd_req_cookie="%CC" captrd_res_cookie="%CS" term_state="%tsc" actconn="%ac" feconn="%fc" beconn="%bc" srv_conn="%sc" retries="%rc" srv_queue="%sq" backend_queue="%bq" captrd_req_headers="%hr" captrd_res_headers="%hs" http_request="%r"\n      logEmptyRequests: Log\n')),"\n",o.createElement(t.p,null,"After updating the ingress controller configuration, you can tail the haproxy logs on a router pod. To list the available router pods, run the ",o.createElement(t.code,null,"oc get -n openshift-ingress pods")," command."),"\n",o.createElement(t.pre,null,o.createElement(t.code,{className:"language-none",title:"Output"},"$ oc logs -f -n openshift-ingress router-default-<id> log\n")),"\n",o.createElement(t.p,null,"Ideally, if your app is accessible on the pods that it is running on and through the service, the problem lies with the ingress configuration. Troubleshooting issues with ingress is beyond the scope of this post."),"\n",o.createElement(t.p,null,"For more information on the OpenShift Ingress Operator, see the ",o.createElement(t.a,{href:"https://docs.openshift.com/container-platform/4.11/networking/ingress-operator.html"},"official documentation"),"."),"\n",o.createElement(t.p,null,"While in these examples, the app is reachable at every step, you can use this approach to reveal whether a connectivity issue prevents you from connecting to your app successfully from your exposed route if you are facing an ",o.createElement(t.em,null,"Application is not available")," error page."))}var r=function(e){void 0===e&&(e={});var t=Object.assign({},(0,l.ah)(),e.components).wrapper;return t?o.createElement(t,e,o.createElement(a,e)):a(e)},c=n(4765);function i(e){return o.createElement(c.Z,e,o.createElement(r,e))}c.Z},6459:function(e,t,n){function o(e){if(null==e)throw new TypeError("Cannot destructure "+e)}n.d(t,{Z:function(){return o}})}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-users-jasonb-self-repos-blog-content-posts-20221206-openshift-connect-index-mdx-c6c119368167adaf583a.js.map